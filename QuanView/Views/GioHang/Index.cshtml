@model QuanApi.Data.GioHang
@if (Model == null || Model.ChiTietGioHangs == null || !Model.ChiTietGioHangs.Any())
{
    <div class="container py-4"><h3>Giỏ hàng của bạn đang trống.</h3></div>
    return;
}
@{
    ViewData["Title"] = "Giỏ hàng";
    var gioHang = Model;
    var chiTietList = gioHang?.ChiTietGioHangs?.ToList() ?? new List<QuanApi.Data.ChiTietGioHang>();
    decimal tongTien = chiTietList.Sum(x => x.GiaBan * x.SoLuong);
}
<style>
.cart-table th, .cart-table td { vertical-align: middle; border: none; }
.cart-img { width: 70px; height: 70px; object-fit: cover; border-radius: 8px; background: #f8f8f8; }
.cart-product-title { font-weight: 500; font-size: 1.05rem; margin-bottom: 2px; }
.cart-price { color: #222; font-weight: bold; font-size: 1.1rem; }
.cart-qty-btn { width: 28px; height: 28px; border: 1px solid #ddd; background: #fff; border-radius: 50%; font-size: 1.1rem; line-height: 1; }
.cart-qty-input { width: 38px; text-align: center; border-radius: 6px; border: 1px solid #ddd; }
.cart-remove-btn { color: #222; background: #f5f5f5; border: none; border-radius: 50%; width: 32px; height: 32px; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; transition: background 0.2s; }
.cart-remove-btn:hover { background: #eee; color: #d32f2f; }
.cart-summary { background: #faf9f6; border-radius: 8px; padding: 24px; }
.cart-summary-total { font-size: 1.2rem; color: #d32f2f; font-weight: bold; }
.cart-summary-btn { width: 100%; padding: 12px 0; font-size: 1.05rem; font-weight: bold; background: #111; color: #fff; border: none; border-radius: 4px; margin-top: 18px; transition: background 0.2s; }
.cart-summary-btn:hover { background: #333; }
.cart-action-btn { padding: 10px 28px; border-radius: 4px; border: 1px solid #111; background: #fff; color: #111; font-weight: 500; margin-right: 12px; transition: background 0.2s, color 0.2s; }
.cart-action-btn:hover { background: #111; color: #fff; }
</style>

<div class="container py-4">
    <h2 class="mb-4">Giỏ hàng</h2>
    <div class="row">
        <div class="col-lg-8 mb-4">
            <table class="table cart-table align-middle">
                <thead>
                    <tr style="border-bottom: 2px solid #eee;">
                        <th style="width:90px;">SẢN PHẨM</th>
                        <th></th>
                        <th style="width:120px;">SỐ LƯỢNG</th>
                        <th style="width:120px;">THÀNH TIỀN</th>
                        <th style="width:50px;"></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in chiTietList)
                    {
                        var spct = item.SanPhamChiTiet;
                        var sp = spct?.SanPham;
                        var img = spct?.AnhSanPhams?.FirstOrDefault(a => a.LaAnhChinh)?.UrlAnh ?? "/img/default-product.jpg";
                        <tr style="border-bottom: 1px solid #f2f2f2;">
                            <td>
                                <img src="@img" class="cart-img" alt="@sp?.TenSanPham">
                            </td>
                            <td>
                                <div class="cart-product-title">@sp?.TenSanPham</div>
                                <div class="cart-price">@item.GiaBan.ToString("N0") VND</div>
                            </td>
                            <td>
                                <div class="d-flex align-items-center justify-content-center">
                                    <form method="post" action="/GioHang/Update" class="d-inline">
                                        <input type="hidden" name="idghct" value="@item.IDChiTietGioHang" />
                                        <input type="hidden" name="iduser" value="@gioHang.IDKhachHang" />
                                        <button type="submit" name="soluong" value="@(item.SoLuong-1)" class="cart-qty-btn" @(item.SoLuong<=1?"disabled":"")>&lt;</button>
                                    </form>
                                    <input type="text" class="cart-qty-input mx-1" value="@item.SoLuong" readonly />
                                    <form method="post" action="/GioHang/Update" class="d-inline">
                                        <input type="hidden" name="idghct" value="@item.IDChiTietGioHang" />
                                        <input type="hidden" name="iduser" value="@gioHang.IDKhachHang" />
                                        <button type="submit" name="soluong" value="@(item.SoLuong+1)" class="cart-qty-btn">&gt;</button>
                                    </form>
                                </div>
                            </td>
                            <td class="fw-bold">@((item.GiaBan * item.SoLuong).ToString("N0")) VND</td>
                            <td>
                                <form method="post" action="/GioHang/Delete" onsubmit="return confirm('Xóa sản phẩm này khỏi giỏ hàng?');">
                                    <input type="hidden" name="idgiohang" value="@item.IDChiTietGioHang" />
                                    <input type="hidden" name="iduser" value="@gioHang.IDKhachHang" />
                                    <button type="submit" class="cart-remove-btn"><span aria-hidden="true">&times;</span></button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            <div class="d-flex justify-content-between mt-4">
                <a href="/SanPhamNguoiDung/Index" class="cart-action-btn">TIẾP TỤC MUA SẮM</a>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="cart-summary">
                <div class="mb-2 mt-4" style="font-weight:600;">TỔNG GIỎ HÀNG</div>
                <div class="d-flex justify-content-between mb-2">
                    <span>Tạm tính</span>
                    <span style="color:#d32f2f;" id="tamTinh">@tongTien.ToString("N0") VND</span>
                </div>
                

                <div class="d-flex justify-content-between mb-2">
                    <span>Tổng cộng</span>
                    <span style="color:#d32f2f;" id="tongCong">@tongTien.ToString("N0") VND</span>
                </div>
                <a href="/Checkout/Index" class="cart-summary-btn" style="text-decoration: none; display: block; text-align: center;">TIẾN HÀNH ĐẶT HÀNG</a>
            </div>
        </div>
    </div>
</div>



<script>
// Cập nhật thông tin thanh toán (không có giảm giá)
function updatePaymentInfo() {
    // Tính tổng tiền từ giỏ hàng
    let total = 0;
    @foreach (var item in chiTietList)
    {
        <text>total += @(item.GiaBan * item.SoLuong);</text>
    }
    
    // Tổng cộng = Tạm tính (không có giảm giá)
    $('#tongCong').text(total.toLocaleString() + ' VND');
}
</script>

