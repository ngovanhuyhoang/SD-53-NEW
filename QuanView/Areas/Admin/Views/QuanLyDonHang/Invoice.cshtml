<!-- SD-53/QuanView/Areas/Admin/Views/QuanLyDonHang/Invoice.cshtml -->
@model QuanApi.Data.HoaDon
@{
    Layout = null;
    var subTotal = Model.ChiTietHoaDons?.Sum(x => x.ThanhTien) ?? 0m;
    var discount = Model.TienGiam ?? 0m;
    var ship = Model.PhiVanChuyen ?? 0m;
    var grand = subTotal - discount + ship;
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <title>Hóa đơn @Model.MaHoaDon</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="~/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body {
            font-family: Arial, sans-serif;
            color: #212529;
        }

        .invoice {
            max-width: 900px;
            margin: 24px auto;
            padding: 32px;
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
        }

        .brand {
            font-size: 20px;
            font-weight: 700;
        }

        .muted {
            color: #6c757d;
        }

        .table th, .table td {
            vertical-align: middle !important;
        }

        .totals td {
            border-top: none !important;
        }

        .title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        @@media print {
            .no-print

        {
            display: none !important;
        }

        body {
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        }
    </style>
</head>
<body onload="window.print()">
    <div class="invoice">
        <div class="invoice-header">
            <div>
                <div class="brand">Cửa hàng Quần Áo</div>
                <div class="muted">Mã hóa đơn: <strong>@Model.MaHoaDon</strong></div>
                <div class="muted">Ngày: @Model.NgayTao.AddHours(7).ToString("HH:mm dd/MM/yyyy")</div>
            </div>
            <div class="text-right">
                <div class="title">Thông tin khách hàng</div>
                <div>@(Model.KhachHang?.TenKhachHang ?? Model.TenNguoiNhan ?? "Khách")</div>
                <div>@Model.SoDienThoaiNguoiNhan</div>
                @if (!string.IsNullOrEmpty(Model.DiaChiGiaoHang))
                {
                    <div>@Model.DiaChiGiaoHang</div>
                }
            </div>
        </div>

        <hr />

        <div class="mb-3">
            <div class="title">Chi tiết sản phẩm</div>
            <table class="table table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th>#</th>
                        <th>Sản phẩm</th>
                        <th>Thuộc tính</th>
                        <th class="text-right">Đơn giá</th>
                        <th class="text-center">SL</th>
                        <th class="text-right">Thành tiền</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        var index = 1;
                        var items = Model.ChiTietHoaDons ?? new List<QuanApi.Data.ChiTietHoaDon>();
                    }
                    @foreach (var ct in items)
                    {
                        <tr>
                            <td>@index</td>
                            <td>
                                <div class="font-weight-bold">@ct.SanPhamChiTiet?.SanPham?.TenSanPham</div>
                                <div class="text-muted small">Mã SPCT: @(ct.SanPhamChiTiet?.MaSPChiTiet ?? "-")</div>
                            </td>
                            <td class="text-muted">
                                Màu: @(ct.SanPhamChiTiet?.MauSac?.TenMauSac ?? "-") |
                                Size: @(ct.SanPhamChiTiet?.KichCo?.TenKichCo ?? "-") |
                                Họa tiết: @(ct.SanPhamChiTiet?.HoaTiet?.TenHoaTiet ?? "Không có")
                            </td>
                            <td class="text-right">@ct.DonGia.ToString("N0")</td>
                            <td class="text-center">@ct.SoLuong</td>
                            <td class="text-right font-weight-bold">@ct.ThanhTien.ToString("N0")</td>
                        </tr>
                        index++;
                    }
                </tbody>
            </table>
        </div>

        <div class="row">
            <div class="col-6">
                <div class="title">Ghi chú</div>
                <div class="text-muted">Phương thức thanh toán: @(Model.PhuongThucThanhToan?.TenPhuongThuc ?? "N/A")</div>
                <div class="text-muted">Trạng thái: @Model.TrangThai</div>
            </div>
            <div class="col-6">
                <table class="table totals">
                    <tr>
                        <td class="text-right">Tạm tính</td>
                        <td class="text-right" style="width: 180px;">@subTotal.ToString("N0") VNĐ</td>
                    </tr>
                    <tr>
                        <td class="text-right">Giảm giá</td>
                        <td class="text-right">-@discount.ToString("N0") VNĐ</td>
                    </tr>
                    <tr>
                        <td class="text-right">Phí vận chuyển</td>
                        <td class="text-right">@ship.ToString("N0") VNĐ</td>
                    </tr>
                    <tr>
                        <td class="text-right font-weight-bold">Tổng cộng</td>
                        <td class="text-right font-weight-bold text-primary">@grand.ToString("N0") VNĐ</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="mt-4 d-flex justify-content-between no-print">
            <button class="btn btn-secondary" onclick="window.close()">Đóng</button>
            <button class="btn btn-primary" onclick="window.print()"><i class="fas fa-print"></i> In hóa đơn</button>
        </div>

        <div class="mt-5 text-center text-muted" style="font-size:12px;">
            Cảm ơn quý khách và hẹn gặp lại!
        </div>
    </div>
</body>
</html>